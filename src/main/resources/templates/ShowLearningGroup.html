<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="fragments/header :: header"/>
    <script src='//cdn.tinymce.com/4/tinymce.min.js'></script>

</head>
<body>

<div th:replace="fragments/navbar :: loggedIn"></div>
<br/>

<div class="row" id="topAnchor">
        <div class="small-3 columns" data-sticky-container="">
            <div class="card" data-sticky="" data-anchor="topAnchor">
                <div class="image">
                    <img src="http://static.pexels.com/wp-content/uploads/2014/07/alone-clouds-hills-1909-527x350.jpg"/>
                    <span class="title" th:text="${learningGroup.name}"></span>
                </div>
                <div class="content">
                    <p><a class="cardLink" data-open="memberModal">
                        <span th:text="${learningGroup.members.size()}"></span> Member
                    </a>
                    </p>
                    <div class="reveal" id="memberModal" data-reveal="true">
                        <p class="lead">Member of the learning group <span th:text="${learningGroup.name}"></span>:</p>
                        <table>
                            <thead>
                            <tr>
                                <th>Username</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody id="tableBody" th:each="member : ${learningGroup.members}">
                            <tr>
                                <td th:text="${member.username}">Group name</td>
                                <td><a href="#" class="button">See profile (no function)</a></td>
                            </tr>
                            </tbody>
                        </table>
                        <button class="close-button" data-close="memberModal" aria-label="Close modal" type="button">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                </div>
                <div class="action">
                    <a class="cardLink fa fa-pencil" data-open="writeNewPostModal"> Create new post</a>
                </div>
            </div>
        </div>

    <!-- Displays for each group post in all group posts the title and text... -->
    <div class="small-9 columns">
        <div class="small-10 small-offset-1 columns end" th:each="groupPost,iterStat : ${groupPosts}">

            <div class="callout-card">
                <div class="card-label">
                    <!-- First three chars of the username are displayed -->
                    <div class="label-text" th:text="${groupPost.associatedUser.username.substring(0, 3)}">
                    </div>
                </div>
                <div class="callout-card-content">
                    <h3 class="lead" th:text="${groupPost.title}"> Title</h3>
                    <p th:utext="${groupPost.text}">Message Text</p>
                </div>
            </div>

            <ul class="vertical menu" data-accordion-menu="true">
                <li>
                    <a href="#" style="outline: none">Show comments</a>
                    <ul th:class="${iterStat.first}? 'is-active'">
                        <li th:each="comment : ${comments}"
                            th:if="${comment.associatedGroupPost.id == groupPost.id}">
                            <div class="callout-card secondary">
                                <div class="card-label">
                                    <div class="label-text"
                                         th:text="${comment.creator.username.substring(0, 3)}"></div>
                                </div>
                                <div class="callout-card-content">
                                    <p th:utext="${comment.text}">Message Text</p>
                                </div>
                            </div>
                        </li>

                        <form th:object="${comment}" th:action="@{/newComment(groupPostId=${groupPost.id})}"
                              method="post">

                            <textarea th:field="*{text}">Hello</textarea>
                            <div class="callout alert" th:if="${#fields.hasErrors('text')}" th:errors="*{text}">Text
                                Error
                            </div>

                            <div style="padding-top: 10px">
                                <button align="right" type="submit" class="button">Save comment</button>
                            </div>
                        </form>
                    </ul>
                </li>
            </ul>

        </div>
    </div>

    <!-- Modal  -->
    <div class="reveal" id="writeNewPostModal" data-reveal="true">

        <div class="row">
            <div class="small-12 columns">
                <form th:object="${newGroupPost}" th:action="@{/newGroupPost(learningGroupId=${learningGroup.id})}"
                      method="post">

                    <p>Write a new group post!</p>

                    <div style="padding-bottom: 20px">
                        <input th:field="*{title}" placeholder="Title"/>
                    </div>

                    <textarea id="mytextareaforpost" th:field="*{text}">Hello</textarea>
                    <div class="callout alert" th:if="${#fields.hasErrors('text')}" th:errors="*{text}">Text Error
                    </div>

                    <div style="padding-top: 20px">
                        <button align="right" type="submit" class="button">Save comment</button>
                    </div>
                </form>
            </div>
        </div>
        <button class="close-button" data-close="writeNewPostModal" aria-label="Close modal" type="button">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

</div>

<!-- js for the Modal -->
<script>
    tinymce.init({
        selector: '#mytextareaforpost',
        statusbar: false,
        toolbar: "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist | "
    });
</script>


<script src="js/app.js"></script>

</body>
</html>