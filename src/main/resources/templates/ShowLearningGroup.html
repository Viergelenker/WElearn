<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="fragments/header :: header"/>
    <script src='//cdn.tinymce.com/4/tinymce.min.js'></script>

</head>
<body>

<div th:replace="fragments/navbar :: loggedIn"></div>
<br/>

<div class="row" id="topAnchor">
    <div class="small-3 columns" data-sticky-container="">
        <div class="card" data-sticky="" data-anchor="topAnchor">
            <div class="image">
                <img src="http://static.pexels.com/wp-content/uploads/2014/07/alone-clouds-hills-1909-527x350.jpg"/>
                <span class="title" th:text="${learningGroup.name}"></span>
            </div>
            <div class="content">
                <p><a class="cardLink" data-open="memberModal">
                    <span th:text="${learningGroup.members.size()}"></span> Member
                </a>
                </p>

                <!-- Member modal -->
                <div class="reveal" id="memberModal" data-reveal="true">
                    <p class="lead">Member of the learning group <span th:text="${learningGroup.name}"></span>:</p>
                    <table>
                        <thead>
                        <tr>
                            <th>Username</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody id="tableBody" th:each="member : ${learningGroup.members}">
                        <tr>
                            <td th:text="${member.username}">Group name</td>
                            <td><a th:href="@{/showUserProfile(userId=${member.id})}"
                                   class="button">See profile</a></td>
                        </tr>
                        </tbody>
                    </table>
                    <button class="close-button" data-close="memberModal" aria-label="Close modal" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

            </div>
            <div class="action">
                <a class="cardLink" th:href="@{/startQuiz(learningGroupId=${learningGroup.id})}"><span
                        class="fa fa-check"> Start quiz</span></a>
            </div>
            <div class="action">
                <a class="cardLink" data-open="writeNewPostModal"><span class="fa fa-pencil"></span> Write new post</a>
            </div>
            <div class="action">
                <a class="cardLink" data-open="writeNewQuestionModal"><span class="fa fa-question"></span> Create new
                    question</a>
            </div>
            <div class="action">
                <a class="cardLink" data-open="writeNewMCQuestionModal"><span class="fa fa-check-square-o"></span>
                    Create new MC-question </a>
            </div>
            <div class="action">
                <a class="cardLink" data-open="fileUploadModal"><span class="fa fa-upload"></span> Upload file</a>
            </div>
            <div class="action">
                <a class="cardLink" data-open="fileDownloadModal"><span class="fa fa-download"></span> See uploaded
                    files</a>
            </div>
        </div>
    </div>

    <h3>Quiz points: <span th:text="${quizPoints}"></span></h3>

    <!-- File upload modal -->
    <div class="reveal" id="fileUploadModal" data-reveal="true">
        <form method="POST" enctype="multipart/form-data" th:action="@{/fileUpload(fileExtension)}">
            <table>
                <tr>
                    <td>File to upload:</td>
                    <td><input type="file" name="file"/></td>
                </tr>
                <tr>
                    <td>Name:</td>
                    <td><input type="text" name="name"/>
                        <select name="fileExtension">
                            <option th:value=".pdf">.pdf</option>
                            <option th:value=".jpg">.jpg</option>
                            <option th:value=".png">.png</option>
                            <option th:value=".mp3">.mp3</option>
                            <option th:value=".docx">.docx</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td><input type="submit" value="Upload"/></td>
                </tr>
                <input type="hidden" th:value="${learningGroup.id}" name="learningGroupId"/>
            </table>
        </form>
        <button class="close-button" data-close="memberModal" aria-label="Close modal" type="button">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <!-- File download modal -->
    <div class="reveal" id="fileDownloadModal" data-reveal="true">
        <div th:if="${files.isEmpty()}">
            <h3>No file uploads</h3>
        </div>
        <div>
            <div th:each="file : ${fileNames}">
                <a th:href="@{'public/'+ ${file}}" th:attr="download=${file}"><span th:text="${file}"></span> </a>
            </div>
        </div>
    </div>

    <!-- Displays for each group post in all group posts the title and text... -->
    <div class="small-9 columns">
        <div class="small-10 small-offset-1 columns end" th:each="groupPost,iterStat : ${groupPosts}">

            <div class="callout-card">
                <div class="card-label">
                    <!-- First three chars of the username are displayed -->
                    <div class="label-text" th:text="${groupPost.associatedUser.username.substring(0, 3)}">
                    </div>
                </div>
                <div class="callout-card-content">
                    <h3 class="lead" th:text="${groupPost.title}"> Title</h3>
                    <p th:utext="${groupPost.text}">Message Text</p>
                </div>
            </div>

            <ul style="padding-bottom: 20px" class="vertical menu small-11 columns end" data-accordion-menu="true">
                <li>
                    <a href="#" style="outline: none">Comments &nbsp;<span class="fa fa-comments"></span></a>
                    <ul th:class="${iterStat.first}? 'is-active'">
                        <div th:each="comment : ${comments}"
                             th:if="${comment.associatedGroupPost.id == groupPost.id}">
                            <div class="callout-card secondary">
                                <div class="card-label">
                                    <div class="label-text"
                                         th:text="${comment.creator.username.substring(0, 3)}"></div>
                                </div>
                                <div class="callout-card-content">
                                    <p th:utext="${comment.text}">Message Text</p>
                                </div>
                            </div>
                        </div>
                    </ul>
                </li>
            </ul>
            <div class="row" style="padding-top: 6px">
                <div class="small-12 columns">
                    <div>Write a new comment:</div>
                    <form th:object="${comment}" th:action="@{/newComment(groupPostId=${groupPost.id})}"
                          method="post">
                        <textarea maxlength="300" class="area" th:field="*{text}">Hello</textarea>
                        <div class="callout alert" th:if="${#fields.hasErrors('text')}" th:errors="*{text}">
                            Text Error
                        </div>
                        <div style="padding-top: 10px">
                            <button align="right" type="submit" class="button">Save Comment
                                &nbsp;<span class="fa fa-commenting"></span></button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>

    <!-- Question modal -->
    <div th:replace="fragments/questionModal"></div>

    <!-- Quiz modal -->
    <div th:replace="fragments/createQuizModal"></div>

    <!-- MC Question modal -->
    <div th:replace="fragments/mcQuestionModal"></div>

    <!-- Group post modal  -->
    <div th:replace="fragments/groupPostModal"></div>

</div>

<!-- js for the modal, textarea and buttons -->
<script src="js/app.js"></script>
<script>
    $(document).ready(function () {

        $(".buttonPost").attr("disabled", "true");
        $(".buttonComment").attr("disabled", "true");

        tinymce.init({
            setup: function (editor) {
                editor.on('keyup', function (e) {
                    if (editor.getContent().length > 0) {
                        $('.buttonPost').removeAttr("disabled");
                    } else {
                        $('.buttonPost').attr("disabled", "true");
                    }
                });
            },
            selector: '#mytextareaforpost',
            statusbar: false,
            plugins: 'link image code',
            toolbar: "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist | "
        });

        tinymce.init({
            selector: '.mytextarea',
            statusbar: false,
            toolbar: "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist | "
        });

        $('.area').on("keyup", action);
        function action() {
            if ($('.area').val().length > 0) {
                $('.buttonComment').removeAttr("disabled");
            } else {
                $('.buttonComment').attr("disabled", "true");
            }
        }
    });
</script>
</body>
</html>