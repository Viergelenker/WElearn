<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="fragments/header :: header"/>
    <script src='//cdn.tinymce.com/4/tinymce.min.js'></script>

</head>
<body>

<div th:replace="fragments/navbar :: loggedIn"></div>
<br/>

<div class="row" id="topAnchor">
    <div class="small-3 columns" data-sticky-container="">
        <div class="card" data-sticky="" data-anchor="topAnchor">
            <div class="image">
                <img src="http://static.pexels.com/wp-content/uploads/2014/07/alone-clouds-hills-1909-527x350.jpg"/>
                <span class="title" th:text="${learningGroup.name}"></span>
            </div>
            <div class="content">
                <p><a class="cardLink" data-open="memberModal">
                    <span th:text="${learningGroup.members.size()}"></span> Member
                </a>
                </p>
                <div class="reveal" id="memberModal" data-reveal="true">
                    <p class="lead">Member of the learning group <span th:text="${learningGroup.name}"></span>:</p>
                    <table>
                        <thead>
                        <tr>
                            <th>Username</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody id="tableBody" th:each="member : ${learningGroup.members}">
                        <tr>
                            <td th:text="${member.username}">Group name</td>
                            <td><a href="#" class="button">See profile (no function)</a></td>
                        </tr>
                        </tbody>
                    </table>
                    <button class="close-button" data-close="memberModal" aria-label="Close modal" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            </div>
            <div class="action">
                <a class="cardLink"><span class="fa fa-check">Start quiz</span></a>
            </div>
            <div class="action">
                <a class="cardLink" data-open="writeNewPostModal"><span class="fa fa-pencil"></span> Create new post</a>
            </div>
            <div class="action">
                <a class="cardLink" data-open="writeNewQuestionModal"><span class="fa fa-pencil"></span>Create new question</a>
            </div>
            <div class="action">
                <a class="cardLink"><span class="fa fa-pencil"></span>Create new MC-question </a>
            </div>
        </div>
    </div>

    <!-- Displays for each group post in all group posts the title and text... -->
    <div class="small-9 columns">
        <div class="small-10 small-offset-1 columns end" th:each="groupPost,iterStat : ${groupPosts}">

            <div class="callout-card">
                <div class="card-label">
                    <!-- First three chars of the username are displayed -->
                    <div class="label-text" th:text="${groupPost.associatedUser.username.substring(0, 3)}">
                    </div>
                </div>
                <div class="callout-card-content">
                    <h3 class="lead" th:text="${groupPost.title}"> Title</h3>
                    <p th:utext="${groupPost.text}">Message Text</p>
                </div>
            </div>

            <ul style="padding-bottom: 20px" class="vertical menu small-11 columns end" data-accordion-menu="true">
                <li>
                    <a href="#" style="outline: none">Comments &nbsp;<span class="fa fa-comments"></span></a>
                    <ul th:class="${iterStat.first}? 'is-active'">
                        <li th:each="comment : ${comments}"
                            th:if="${comment.associatedGroupPost.id == groupPost.id}">
                            <div class="callout-card secondary">
                                <div class="card-label">
                                    <div class="label-text"
                                         th:text="${comment.creator.username.substring(0, 3)}"></div>
                                </div>
                                <div class="callout-card-content">
                                    <p th:utext="${comment.text}">Message Text</p>
                                </div>
                            </div>
                        </li>
                        <div class="small-5 small-offset-7 columns">
                            <a class="hollow button" data-open="writeNewCommentModal">New Comment &nbsp;<span
                                    class="fa fa-commenting"></span></a>

                        </div>
                    </ul>
                </li>
            </ul>

            <!-- Comment modal  -->
            <div class="reveal" id="writeNewCommentModal" data-reveal="true">

                <div class="row">
                    <div class="small-12 columns">

                        <h4>Write a new comment:</h4>

                        <form th:object="${comment}" th:action="@{/newComment(groupPostId=${groupPost.id})}"
                              method="post">

                            <textarea maxlength="300" class="area" th:field="*{text}">Hello</textarea>
                            <div class="callout alert" th:if="${#fields.hasErrors('text')}" th:errors="*{text}">Text
                                Error
                            </div>

                            <div style="padding-top: 10px">
                                <button align="right" type="submit" class="buttonComment">Save comment</button>
                            </div>
                        </form>
                    </div>
                </div>
                <button class="close-button" data-close="writeNewCommentModal" aria-label="Close modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

        </div>
    </div>

    <!-- Question modal -->
    <div class="reveal" id="writeNewQuestionModal" data-reveal="true">
        <div class="row">
            <div class="small-12 columns">
                <form th:object="${newQuestion}" th:action="@{/newQuestion(learningGroupId=${learningGroup.id})}" method="post">
                    <p>Write new question!</p>
                    <div style="padding-bottom: 20px">
                        <textarea id="mytextareaforquestion" th:field="*{question}">Question</textarea>
                        <div class="callout alert" th:if="${#fields.hasErrors('question')}" th:errors="*{question}">Question Error
                        </div>
                        <textarea id="mytextareaforanswer" th:field="*{answer}">Answer</textarea>
                        <div class="callout alert" th:if="${#fields.hasErrors('answer')}" th:errors="*{answer}">Answer Error
                        </div>
                        <div style="padding-top: 20px">
                            <button align="right" type="submit" class="buttonPost">Save question</button>
                        </div>
                        <button class="close-button" data-close="writeNewQuestionModal" aria-label="Close modal" type="button">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- Group post modal  -->
    <div class="reveal" id="writeNewPostModal" data-reveal="true">

        <div class="row">
            <div class="small-12 columns">
                <form th:object="${newGroupPost}" th:action="@{/newGroupPost(learningGroupId=${learningGroup.id})}"
                      method="post">

                    <p>Write a new group post!</p>

                    <div style="padding-bottom: 20px">
                        <input th:field="*{title}" placeholder="Title"/>
                    </div>

                    <textarea id="mytextareaforpost" th:field="*{text}">Hello</textarea>
                    <div class="callout alert" th:if="${#fields.hasErrors('text')}" th:errors="*{text}">Text Error
                    </div>

                    <div style="padding-top: 20px">
                        <button align="right" type="submit" class="buttonPost">Save comment</button>
                    </div>
                </form>
            </div>
        </div>
        <button class="close-button" data-close="writeNewPostModal" aria-label="Close modal" type="button">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

</div>

<!-- js for the Modal -->
<script>
    $(document).ready(function () {

        $(".buttonPost").attr("disabled", "true");
        $(".buttonComment").attr("disabled", "true");

        tinymce.init({
            setup: function (editor) {
                editor.on('keyup', function (e) {
                    if (editor.getContent().length > 0) {
                        $('.buttonPost').removeAttr("disabled");
                    } else {
                        $('.buttonPost').attr("disabled", "true");
                    }
                });
            },
            selector: '#mytextareaforpost',
            statusbar: false,
            toolbar: "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist | "
        });


        $('.area').on("keyup", action);
        function action() {
            if ($('.area').val().length > 0) {
                $('.buttonComment').removeAttr("disabled");
            } else {
                $('.buttonComment').attr("disabled", "true");
            }
        }
    });

</script>


<script src="js/app.js"></script>

</body>
</html>